<%- include("../../views/partials/user/header") %>

<style>
  /* Pagination Styles */
  .pagination-circle .page-link {
    border-radius: 50% !important;
    margin: 0 3px;
    width: 40px;
    height: 40px;
    text-align: center;
    line-height: 28px;
    padding: 0.5rem;
    border: 2px solid #dee2e6;
    color: #6c757d;
    transition: all 0.3s ease;
  }

  .pagination-circle .page-link:hover {
    background-color: #f8f9fa;
    border-color: #000000;
    color: #000000;
    transform: translateY(-2px);
  }

  .pagination-circle .page-item.active .page-link {
    background-color: #ffffff;
    color: rgb(0, 0, 0);
    border-color: #000000;
  }

  /* Search Header */
  .search-header {
    color: white;
    padding: 2rem 0;
    margin-bottom: 2rem;
    border-radius: 0 0 20px 20px;
  }

  /* Product Card Styles */
  .product-card {
    border: none;
    border-radius: 15px;
    overflow: hidden;
    transition: all 0.3s ease;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
    height: 100%;
  }

  .product-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
  }

  .product-image {
    position: relative;
    overflow: hidden;
  }

  .product-image img {
    height: 200px;
    object-fit: cover;
    transition: transform 0.3s ease;
    width: 100%;
  }

  .product-card:hover .product-image img {
    transform: scale(1.05);
  }

  /* No Results Styling */
  .no-results {
    text-align: center;
    padding: 3rem 1rem;
  }

  .no-results-icon {
    font-size: 4rem;
    color: #dee2e6;
    margin-bottom: 1rem;
  }
  .product-content-wrap {
    padding: 15px;
    text-align: center;
  }

  .product-content-wrap h6 {
    font-size: 16px;
    font-weight: 600;
    color: #333;
    margin-bottom: 8px;
    line-height: 1.4;
  }

  .product-content-wrap h5 {
    font-size: 18px;
    color: #080707;
    margin-bottom: 12px;
    font-weight: 700;
  }
  .product-content-wrap a {
    display: inline-block;
    padding: 10px 20px;
    background-color: #333;
    color: white;
    text-transform: uppercase;
    font-size: 12px;
    text-decoration: none;
    border-radius: 6px;
    transition: 0.3s ease;
    font-weight: 600;
  }

  .product-content-wrap a:hover {
    background-color: #070707;
    color: white;
  }
  /* Updated price display styles for better responsiveness */
  .product-price-container {
    display: flex;
    align-items: center;
    justify-content: center;
    flex-wrap: wrap;
    gap: 8px;
    margin-bottom: 10px;
  }

  .product-price-container h5 {
    margin-bottom: 0;
    font-size: 16px;
    font-weight: 700;
    color: #080707;
  }

  .product-price-container .text-muted {
    font-size: 14px;
    text-decoration: line-through;
  }

  .product-price-container .badge {
    font-size: 11px;
    padding: 4px 8px;
  }

  /* 1024px screen - 2 products per line */
  @media screen and (max-width: 1024px) and (min-width: 992px) {
    .col-lg-3.col-md-4.col-12.col-sm-6 {
      flex: 0 0 50%;
      max-width: 50%;
    }

    .product-price-container {
      gap: 6px;
    }

    .product-price-container h5 {
      font-size: 15px;
    }

    .product-price-container .text-muted {
      font-size: 13px;
    }
  }

  @media screen and (max-width: 480px) {
    /* Ensure prices stay in one line on very small screens */
    .product-price-container {
      gap: 2px;
      flex-wrap: nowrap;
    }

    .product-price-container h5 {
      font-size: 12px;
    }

    .product-price-container .text-muted {
      font-size: 10px;
    }

    .product-price-container .badge {
      font-size: 8px;
      padding: 2px 4px;
    }
  }

  /* Mobile Responsive Adjustments */
  @media (max-width: 576px) {
    .search-header {
      padding: 1.5rem 0;
      margin-bottom: 1.5rem;
    }

    .search-header h2 {
      font-size: 1.5rem;
      margin-bottom: 0;
    }

    .product-image img {
      height: 180px;
    }

    .pagination-circle .page-link {
      width: 35px;
      height: 35px;
      margin: 0 2px;
      font-size: 0.85rem;
      line-height: 23px;
    }
    .product-content-wrap {
      padding: 10px;
    }

    .product-content-wrap h6 {
      font-size: 13px;
    }
    /* Smaller price display for extra small screens */
    .product-price-container {
      gap: 3px;
    }

    .product-price-container h5 {
      font-size: 13px;
    }

    .product-price-container .text-muted {
      font-size: 11px;
    }

    .product-price-container .badge {
      font-size: 9px;
      padding: 2px 5px;
    }
  }

  @media (max-width: 768px) {
    .container {
      padding-left: 1rem;
      padding-right: 1rem;
    }
  }
  .product-content-wrap {
    padding: 12px;
  }

  .product-content-wrap h6 {
    font-size: 14px;
    margin-bottom: 6px;
  }

  .product-content-wrap a {
    padding: 8px 16px;
    font-size: 11px;
  }
  /* Updated mobile price display */
  .product-price-container {
    gap: 4px;
    margin-bottom: 8px;
  }

  .product-price-container h5 {
    font-size: 14px;
  }

  .product-price-container .text-muted {
    font-size: 12px;
  }

  .product-price-container .badge {
    font-size: 10px;
    padding: 3px 6px;
  }

  /* Animation for loading */
  .product-grid {
    animation: fadeIn 0.6s ease-in;
  }

  @keyframes fadeIn {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  /* Additional mobile improvements */
  @media screen and (max-width: 400px) {
    .carousel-item {
      height: 180px;
    }

    .carousel-caption {
      padding: 10px;
      bottom: 5px;
    }

    .carousel-caption p {
      font-size: 10px;
      margin-bottom: 8px;
    }
    .product-img img {
      height: 140px;
    }

    .product-content-wrap h6 {
      font-size: 12px;
    }

    /* Ultra small screen price display */
    .product-price-container h5 {
      font-size: 11px;
    }

    .product-price-container .text-muted {
      font-size: 9px;
    }

    .product-price-container .badge {
      font-size: 7px;
      padding: 1px 3px;
    }

    .product-content-wrap a {
      padding: 6px 12px;
      font-size: 10px;
    }
  }
</style>

<div class="search-header">
  <div class="container">
    <h2 class="text-center mb-0">Search Results for "<%= query %>"</h2>
  </div>
</div>

<div class="container pb-4">
  <% if (products.length === 0) { %>
  <div class="no-results">
    <div class="no-results-icon">üîç</div>
    <h4 class="text-muted mb-3">No Products Found</h4>
    <p class="text-muted">
      Try adjusting your search terms or browse our categories.
    </p>
    <a href="/" class="btn btn-primary mt-3">Back to Home</a>
  </div>
  <% } else { %>
  <div class="row g-3 product-grid">
    <% products.forEach(product => { %>
    <div class="col-xl-3 col-lg-4 col-md-4 col-sm-6 col-6">
      <div class="card product-card">
        <div class="product-image">
          <a href="/productDetails?id=<%= product._id %>">
            <img
              src="<%= product.productImages[0] %>"
              class="card-img-top"
              alt="<%= product.productName %>"
              loading="lazy"
            />
          </a>
        </div>
        <% const discount = Math.round(((product.regularPrice -
        product.salePrice) / product.regularPrice) * 100);%>
        <div class="product-content-wrap">
          <h6><%= product.productName %></h6>
          <div class="product-price-container">
            <h5>‚Çπ <%= product.salePrice %></h5>
            <span class="text-muted small">‚Çπ<%= product.regularPrice %></span>
            <span class="badge bg-warning"><%= discount %>% OFF</span>
          </div>
          <div class="small">
            <%= product.description.split('').slice(0, 25).join('') %>...
          </div>
          <div class="small">
            <%= product.material.split('').slice(0, 15).join('') %>... %>
          </div>
        </div>
      </div>
    </div>
    <% }) %>
  </div>

  <!-- Pagination -->
  <div class="d-flex justify-content-center mt-4">
    <nav aria-label="Search results pagination">
      <ul class="pagination pagination-circle mb-0">
        <% if (currentPage > 1) { %>
        <li class="page-item">
          <a
            class="page-link"
            href="/searchFromHome?q=<%= query %>&page=<%= currentPage - 1 %>"
            aria-label="Previous"
          >
            ‚Äπ
          </a>
        </li>
        <% } %> <% let startPage = Math.max(1, currentPage - 2); let endPage =
        Math.min(totalPages, currentPage + 2); if (currentPage <= 3) { endPage =
        Math.min(5, totalPages); } if (currentPage > totalPages - 3) { startPage
        = Math.max(1, totalPages - 4); } %> <% if (startPage > 1) { %>
        <li class="page-item">
          <a class="page-link" href="/searchFromHome?q=<%= query %>&page=1"
            >1</a
          >
        </li>
        <% if (startPage > 2) { %>
        <li class="page-item disabled">
          <span class="page-link">...</span>
        </li>
        <% } %> <% } %> <% for (let i = startPage; i <= endPage; i++) { %>
        <li class="page-item <%= currentPage === i ? 'active' : '' %>">
          <a
            class="page-link"
            href="/searchFromHome?q=<%= query %>&page=<%= i %>"
            ><%= i %></a
          >
        </li>
        <% } %> <% if (endPage < totalPages) { %> <% if (endPage < totalPages -
        1) { %>
        <li class="page-item disabled">
          <span class="page-link">...</span>
        </li>
        <% } %>
        <li class="page-item">
          <a
            class="page-link"
            href="/searchFromHome?q=<%= query %>&page=<%= totalPages %>"
            ><%= totalPages %></a
          >
        </li>
        <% } %> <% if (currentPage < totalPages) { %>
        <li class="page-item">
          <a
            class="page-link"
            href="/searchFromHome?q=<%= query %>&page=<%= currentPage + 1 %>"
            aria-label="Next"
          >
            ‚Ä∫
          </a>
        </li>
        <% } %>
      </ul>
    </nav>
  </div>
  <% } %>
</div>

<%- include("../../views/partials/user/footer") %>
