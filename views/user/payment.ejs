<%- include("../../views/partials/user/header") %>

<div class="container mt-5 mb-5">
  <div class="row">
    <!-- Payment Methods -->
    <div class="col-md-7">
      <h4 class="mb-4">Choose Payment Method</h4>
      <form action="/place-order" method="POST">
        <!-- Hidden Fields to carry data forward -->
        <input type="hidden" name="productId" value="<%= orderSummary.productId %>">
        <input type="hidden" name="quantity" value="<%= orderSummary.quantity %>">
        <input type="hidden" name="totalPrice" value="<%= orderSummary.total %>">
        
        <!-- Coupon information -->
        <% if (orderSummary.couponId) { %>
          <input type="hidden" name="couponId" value="<%= orderSummary.couponId %>">
        <% } %>
        
        <!-- Address Fields -->
        <input type="hidden" name="selected[addressType]" value="<%= selected.addressType %>">
        <input type="hidden" name="selected[name]" value="<%= selected.name %>">
        <input type="hidden" name="selected[city]" value="<%= selected.city %>">
        <input type="hidden" name="selected[landMark]" value="<%= selected.landMark %>">
        <input type="hidden" name="selected[state]" value="<%= selected.state %>">
        <input type="hidden" name="selected[pincode]" value="<%= selected.pincode %>">
        <input type="hidden" name="selected[phone]" value="<%= selected.phone %>">
        <input type="hidden" name="selected[altphone]" value="<%= selected.altphone %>">

        <div class="card p-3 mb-3">
          <div class="form-check">
            <input class="form-check-input" type="radio" name="paymentMethod" id="creditCard" value="credit_card" checked>
            <label class="form-check-label" for="creditCard">
              Credit/Debit Card
            </label>
          </div>
        </div>
        
        <div class="card p-3 mb-3">
          <div class="form-check">
            <input class="form-check-input" type="radio" name="paymentMethod" id="upi" value="upi">
            <label class="form-check-label" for="upi">
              UPI
            </label>
          </div>
        </div>
        
        <div class="card p-3 mb-3">
          <div class="form-check">
            <input class="form-check-input" type="radio" name="paymentMethod" id="netBanking" value="net_banking">
            <label class="form-check-label" for="netBanking">
              Net Banking
            </label>
          </div>
        </div>
        
        <div class="card p-3 mb-3">
          <div class="form-check">
            <input class="form-check-input" type="radio" name="paymentMethod" id="cod" value="cash_on_delivery">
            <label class="form-check-label" for="cod">
              Cash on Delivery
            </label>
          </div>
        </div>

        <button type="submit" class="btn btn-primary mt-3">Continue</button>
      </form>
    </div>

    <!-- Order Summary -->
    <div class="col-md-5">
      <h4 class="mb-4">Order Summary</h4>
      <div class="card p-4 shadow-sm">
        <div class="d-flex mb-3">
          <img src="/uploads/product-images/<%= orderSummary.productImages[0] %>" alt="<%= orderSummary.productName %>" class="me-3 rounded" style="width: 100px; height: 100px; object-fit: cover;">
          <div>
            <h5><%= orderSummary.productName %></h5>
            <p class="mb-1">Qty: <%= orderSummary.quantity %></p>
            <div class="d-flex align-items-center">
              <strong class="me-2">₹<%= orderSummary.price %></strong>
              <% if (orderSummary.regularPrice > orderSummary.price) { %>
                <del class="text-muted">₹<%= orderSummary.regularPrice %></del>
              <% } %>
            </div>
          </div>
        </div>
        
        <hr>
        
        <div class="price-breakdown">
          <div class="d-flex justify-content-between mb-2">
            <span>Price (<%= orderSummary.quantity %> item<%= orderSummary.quantity > 1 ? 's' : '' %>)</span>
            <span>₹<%= orderSummary.originalTotal %></span>
          </div>
          
          <% if (orderSummary.saveAmount > 0) { %>
          <div class="d-flex justify-content-between mb-2">
            <span>Discount</span>
            <span class="text-success">-₹<%= orderSummary.saveAmount %></span>
          </div>
          <% } %>
          
          <% if (orderSummary.couponDiscount > 0) { %>
          <div class="d-flex justify-content-between mb-2">
            <span>Coupon Discount <% if (orderSummary.couponName) { %><small>(<%= orderSummary.couponName %>)</small><% } %></span>
            <span class="text-success">-₹<%= orderSummary.couponDiscount.toFixed(2) %></span>
          </div>
          <% } %>
          
          <div class="d-flex justify-content-between">
            <span>Delivery Charges</span>
            <span class="text-success">FREE</span>
          </div>
          
          <hr>
          
          <div class="d-flex justify-content-between fw-bold">
            <span>Total Amount</span>
            <span>₹<%= orderSummary.total %></span>
          </div>
          
          <% if ((orderSummary.saveAmount + orderSummary.couponDiscount) > 0) { %>
          <div class="text-success mt-2">
            You save ₹<%= (orderSummary.saveAmount + orderSummary.couponDiscount).toFixed(2) %> on this order
          </div>
          <% } %>
        </div>
        
        <hr>
        
        <div class="address-section">
          <h6>Delivery Address:</h6>
          <p class="mb-1"><strong><%= selected.name %></strong></p>
          <p class="mb-1"><%= selected.landMark %>, <%= selected.city %></p>
          <p class="mb-1"><%= selected.state %> - <%= selected.pincode %></p>
          <p class="mb-0">Phone: <%= selected.phone %><% if (selected.altphone) { %>, <%= selected.altphone %><% } %></p>
        </div>
      </div>
    </div>
  </div>
</div>

<%- include("../../views/partials/user/footer") %>